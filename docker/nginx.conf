user                          nginx;
worker_processes              1;

error_log                     /dev/stdout info;
pid                           /tmp/nginx.pid;

events {
  worker_connections          1024;
}

http {
  include                     /etc/nginx/mime.types;
  default_type                application/octet-stream;
  charset                     UTF-8;
  sendfile                    on;
  log_format                  main '$remote_addr - $remote_user [$time_local] "$request" '
                                   '$status $body_bytes_sent "$http_referer" '
                                   '"$http_user_agent" "$http_x_forwarded_for"';

  client_body_temp_path       /tmp/client_temp;
  proxy_temp_path             /tmp/proxy_temp_path;
  fastcgi_temp_path           /tmp/fastcgi_temp;
  uwsgi_temp_path             /tmp/uwsgi_temp;
  scgi_temp_path              /tmp/scgi_temp;
  access_log                  /dev/stdout;


  server {
    include                   /usr/share/nginx/html/headers;
    listen                    8080;
    server_name               localhost;
    client_max_body_size      32m;

    # Gzip compression
    gzip                      on;
    gzip_types                text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript application/x-javascript;
    gzip_proxied              expired no-cache no-store private auth;
    gzip_min_length           1024;

    # Security headers
    add_header                X-Frame-Options "SAMEORIGIN" always;
    add_header                X-Content-Type-Options "nosniff" always;
    add_header                X-XSS-Protection "1; mode=block" always;

    root                      /usr/share/nginx/html;
    index                     index.html;
    server_tokens             off;

    location = /index.html {
      add_header              Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
      expires                 off;
      try_files               /index.html =404;
    }

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        limit_except GET {
            deny  all;
        }
        expires               1y;
        add_header            Cache-Control "public, immutable";
        #access_log            off;
    }

    # API proxy
    #location /api/ {
    #  proxy_pass              http://127.0.0.1:5000/api/;
    #  proxy_http_version      1.1;
    #  proxy_set_header        Host $host;
    #  proxy_set_header        X-Real-IP $remote_addr;
    #  proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    #  proxy_set_header        X-Forwarded-Proto $scheme;
    #}

    # Vue Router - serve index.html for all routes
    location / {
      limit_except GET {
        deny  all;
      }
      expires                 off;
      add_header              Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
      try_files               $uri $uri/ /index.html =404;
      #expires                 1d;
      #add_header              Cache-Control "public, immutable";
    }

    location = /50x.html {
      limit_except GET {
        deny  all;
      }
      root                    /var/lib/nginx/html;
    }

    error_page                404 =404 /index.html;
    error_page                500 502 503 504 /50x.html;
  }
}
